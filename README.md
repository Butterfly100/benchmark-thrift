## What is it  
Benchmark-thrift is an open-source application designed to load test thrift applications and measure performance.  
It's the first out-of-box thrift protocol pressure tool so far and it's simple usage, you could also be integrated within Pressir platform.

## Features  
   * Simple Usage: Using a simple command line, you can press without any code development capabilities   
   * Compatible with various versions of thrift
   * Two types of pressure - not only to meet concurrent requirements, but also to test in the form of fixed throughput

## Requirements  
The following requirements exist for running Benchmark-thrift:
   * ## Java Interpreter:
     A fully compliant Java 8 Runtime Environment is required for Benchmark-thrift to execute.
   * ## Jar package generated by IDL:
     Current tool requires the user to give the jar package which generated by IDL. 
```bash
    thrift -r --gen java xxx.thrift #Generate corresponding java files by command
    sh jar_generator.sh version java_path jar_path  #Version: Specifies the thrift version, java_path: Specifies the Java folder path generated by executing the previous command, and jar_path: Specifies the location and name of the final jar package
```        
## Running Benchmark-thrift  
   Make sure you have JAVA_HOME env is properly configured, and then: 
```bash
    echo $JAVA_HOME             # should print your Java home dir. If the command fails, you need to install the Java environment. Java Downloads: https://www.oracle.com/technetwork/java/javase/downloads/index.html
    cd conf
    vim tsocket.sample.env       # choose and modify the Thrift env file 
    mv tsocket.sample.env thrift.env #rename to a tool-recognizable name 
    cd ../bin
    chmod 755 *.sh              # make it executable
    sh benchmark.sh -c 10 -t 100s 127.0.0.1:8090/Test/test?@data_file # run it. If the duration and pressure type are not specified, the default one-minute concurrent execution is achieved
```

#### Simplest Usage  
```bash
    sh benchmark.sh [options] thrift://<host>:<port>/<service>/<method>[?@<data_file>]
```

#### OPTIONS
   The options are:     
   * -e thrift.env   
   Thrift environment configuration file include Transport, Protocol, Thrift version, and the location of the generated jar package. 
        * ###### Example  
         version=0.12.0  
         client_jar=/Users/didi/test.jar        
         transport=TFramedTransport(transport=TSocket)  
         protocol=TCompactProtocol        
   * -c concurrency    
   The number of multiple requests to make at a time. If no -c nor -q is specified, default value is 1 concurrency
   * -q throughput  
   The number of requests issued in 1 Second. If no -c nor -q is specified, default value is 1 concurrency
   * -t timelimit  
   TimeLimit of the pressure. It with a default value 60s. You can specify the duration in the following ways:
   
         -t 10[s[econd[s]]] or -t 10[m[inute[s]]] or -t 1[h[hour[s]]] or -t 1[d[day[s]]]
   * -v     
   Print version number
   * -h  
   Display usage information  
   * Where: <data_file>      
         A local file that contains request arguments, prefixed by a "@".  
         If the thrift method has parameters, <data_file> is mandatory.
   

## Contributing
Welcome to contribute by creating issues or sending pull requests. See [CONTRIBUTING](CONTRIBUTING.md) for guidelines.

## License
Benchmark-thrift is licensed under the Apache License 2.0. See the [LICENSE](LICENSE) file.

## Note
This is not an official Didi product (experimental or otherwise), it is just code that happens to be owned by Didi.

Thank you for using Benchmark-thrift.

